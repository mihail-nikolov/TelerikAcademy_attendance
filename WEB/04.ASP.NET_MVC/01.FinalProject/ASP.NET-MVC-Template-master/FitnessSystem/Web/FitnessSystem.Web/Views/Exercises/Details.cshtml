@model  FitnessSystem.Web.ViewModels.Exercises.ExerciseFullViewModel
@using Microsoft.AspNet.Identity

@{
    ViewBag.Title = "Details";
}
<h3>@Model.Title</h3>
<div class="row">
    <i>by: </i><strong>@Model.Author</strong> <i>category: </i>
    <strong class="text-danger"><a href="~/Categories/Details/@Model.CategoryId">@Model.Category </a></strong>
    <i>added: </i><strong>@Model.CreatedOn</strong>
    <br />
    @if (Request.IsAuthenticated && Model.AuthorId == User.Identity.GetUserId())
    {
        @Html.ActionLink("Edit", "EditExercise", "Exercises",
                             new { Model.Id }, new { @class = "btn btn-primary" })

        using (Html.BeginForm("Delete", "Exercises", new { area = string.Empty, id = Model.Id }, FormMethod.Post))
        {
            @Html.HiddenFor(model => model.Id)
            <input type="submit" value="Delete" class="btn btn-danger" />
        }
    }
</div>
<br />
<div class="row">
    <span>@Html.Raw(Model.Content)</span><br /><br />
    <i>rating: </i><strong data-id ="@Model.Id" data-action="votesCount" class="text-danger">@Model.Votes</strong><br />
    @if (Request.IsAuthenticated && Model.AuthorId != User.Identity.GetUserId())
    {
        <div class="btn btn-primary" data-action="up" data-id="@Model.Id">Like</div>
        <div class="btn btn-danger" data-action="down" data-id="@Model.Id">DisLike</div>
    }
</div>

@section scripts{
    <script>
        $("div[data-action='up'").click(function () {
            var id = $(this).attr("data-id");
            $.post('/Votes/Vote/', { exId: id, points: 1 },
                function (data) {
                    var newVotes = data.Count;
                    $("div[data-action='votesCount'][data-id]=" + id + "']")
                        .html(newVotes);
                });
        });
    </script>
    @Scripts.Render("~/bundles/jquery")
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>
}